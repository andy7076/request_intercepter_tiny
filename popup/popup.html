<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Request Interceptor</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Outfit:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <!-- CodeMirror Ê†∑Âºè -->
    <link rel="stylesheet" href="lib/codemirror/codemirror.css" />
    <link rel="stylesheet" href="lib/codemirror/addon/fold/foldgutter.css" />
    <link rel="stylesheet" href="popup.css" />
    <link rel="stylesheet" href="popup_search.css" />
    <link rel="stylesheet" href="popup_modal_editor.css" />
  </head>
  <body>
    <div class="container">
      <header class="header">
        <div class="header-content">
          <div class="header-title-row">
            <div class="header-title">
              <h1>Request Interceptor Tiny</h1>
              <p class="subtitle" data-i18n="subtitle">
                Lightweight API Mock Tool
              </p>
            </div>
            <button
              type="button"
              id="open-in-tab-btn"
              class="btn-open-tab"
              data-i18n-title="openInFullWindow"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <rect width="20" height="14" x="2" y="3" rx="2"></rect>
                <line x1="8" x2="16" y1="21" y2="21"></line>
                <line x1="12" x2="12" y1="17" y2="21"></line>
              </svg>
              <span data-i18n="fullView">Full View</span>
            </button>
            <button
              type="button"
              id="settings-btn"
              class="btn-icon-header"
              data-i18n-title="settings"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="20"
                height="20"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="12" cy="12" r="3"></circle>
                <path
                  d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"
                ></path>
              </svg>
            </button>
          </div>
        </div>
      </header>

      <div class="tabs">
        <button class="tab-btn active" data-tab="rules">
          <span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path
                d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"
              ></path>
              <rect x="8" y="2" width="8" height="4" rx="1" ry="1"></rect>
            </svg>
          </span>
          <span data-i18n="tabRulesList">Rules List</span>
        </button>
        <button class="tab-btn" data-tab="add">
          <span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
          </span>
          <span data-i18n="tabAddRule">Add Rule</span>
        </button>
        <button class="tab-btn" data-tab="logs">
          <span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="18" y1="20" x2="18" y2="10"></line>
              <line x1="12" y1="20" x2="12" y2="4"></line>
              <line x1="6" y1="20" x2="6" y2="14"></line>
            </svg>
          </span>
          <span data-i18n="tabRequestLogs">Request Logs</span>
        </button>
      </div>

      <!-- Rules List Panel -->
      <div id="rules-panel" class="panel active">
        <div class="rules-header">
          <span class="rules-count" id="rules-count-text"></span>
          <div class="rules-search">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="search-icon"
            >
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input
              type="text"
              id="rules-search-input"
              data-i18n-placeholder="searchRules"
              placeholder="Search rules..."
              autocomplete="off"
            />
            <button
              type="button"
              id="clear-search-btn"
              class="btn-clear-search"
              data-i18n-title="clearSearch"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="12"
                height="12"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
              </svg>
            </button>
          </div>
          <div class="rules-actions">
            <button
              type="button"
              id="disable-rules-btn"
              class="btn-icon"
              data-i18n-title="disableAllRules"
              style="color: var(--warning)"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="4.93" y1="4.93" x2="19.07" y2="19.07"></line>
              </svg>
            </button>
            <button
              type="button"
              id="clear-rules-btn"
              class="btn-icon"
              data-i18n-title="clearAllRules"
              style="color: var(--danger)"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <polyline points="3 6 5 6 21 6"></polyline>
                <path
                  d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                ></path>
              </svg>
            </button>
            <button
              type="button"
              id="import-btn"
              class="btn-icon"
              data-i18n-title="importRules"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
            </button>
            <button
              type="button"
              id="export-btn"
              class="btn-icon"
              data-i18n-title="exportRules"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
              </svg>
            </button>
          </div>
        </div>
        <div id="rules-list" class="rules-list">
          <div class="empty-state">
            <span class="empty-icon">üìã</span>
            <p data-i18n="noRules">No Rules</p>
            <p class="hint" data-i18n="noRulesHint">
              Click "Add Rule" to create your first rule
            </p>
          </div>
        </div>
        <input
          type="file"
          id="import-file"
          accept=".json"
          style="display: none"
        />
      </div>

      <!-- Add Rule Panel -->
      <div id="add-panel" class="panel">
        <form id="rule-form">
          <div class="form-content">
            <!-- Import from cURL button -->
            <div class="import-curl-section">
              <button
                type="button"
                id="import-curl-btn"
                class="btn-import-curl"
                data-i18n-title="importFromCurlTitle"
              >
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="16"
                  height="16"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  stroke-linecap="round"
                  stroke-linejoin="round"
                >
                  <path d="M4 17l6-6-6-6"></path>
                  <path d="M12 19h8"></path>
                </svg>
                <span data-i18n="importFromCurl">Import from cURL</span>
              </button>
            </div>

            <div class="form-group">
              <label for="rule-name" data-i18n="ruleName">Rule Name</label>
              <input
                type="text"
                id="rule-name"
                data-i18n-placeholder="ruleNamePlaceholder"
                placeholder="e.g., Config Modify API"
                required
              />
            </div>

            <div class="form-group">
              <label for="url-pattern" data-i18n="urlPattern"
                >URL Match Pattern</label
              >
              <input
                type="text"
                id="url-pattern"
                data-i18n-placeholder="urlPatternPlaceholder"
                placeholder="e.g., *://api.example.com/*"
                required
              />
              <span class="hint" data-i18n="urlPatternHint"
                >Supports wildcard * to match any characters</span
              >
            </div>

            <!-- Mock Response Config -->
            <div id="mock-config" class="config-section">
              <div class="form-group">
                <div class="response-label-row">
                  <label for="response-body" data-i18n="responseContent"
                    >Response Content (JSON)</label
                  >
                  <div class="editor-actions">
                    <button
                      type="button"
                      id="expand-editor"
                      class="btn-expand"
                      data-i18n-title="expandEdit"
                    >
                      ‚õ∂
                    </button>
                  </div>
                </div>
                <textarea
                  id="response-body"
                  rows="10"
                  placeholder='{"success": true, "data": {}}'
                ></textarea>
                <div class="json-status">
                  <span
                    id="json-status-indicator"
                    class="json-status-indicator"
                  ></span>
                  <span
                    id="json-status-text"
                    class="hint"
                    data-i18n="responseContentHint"
                    >Enter JSON response content to return</span
                  >
                </div>
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button
              type="button"
              id="reset-btn"
              class="btn-secondary"
              data-i18n="reset"
              style="margin-right: auto"
            >
              Reset
            </button>
            <button
              type="button"
              id="cancel-btn"
              class="btn-secondary"
              data-i18n="cancel"
            >
              Cancel
            </button>
            <button type="submit" class="btn-primary" data-i18n="saveRule">
              Save Rule
            </button>
          </div>
        </form>
      </div>

      <!-- Request Logs Panel -->
      <div id="logs-panel" class="panel">
        <div class="logs-header">
          <span class="logs-info" id="logs-count-text"></span>
          <div class="logs-actions">
            <button
              type="button"
              id="clear-logs-btn"
              class="btn-small btn-danger"
              data-i18n="clearLogs"
            >
              Clear Logs
            </button>
          </div>
        </div>
        <div id="logs-list" class="logs-list">
          <div class="empty-state">
            <span class="empty-icon">üìä</span>
            <p data-i18n="noLogs">No Logs</p>
            <p class="hint" data-i18n="noLogsHint">
              Matched requests will be displayed here when rules match
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Fullscreen Editor Modal -->
    <div id="editor-modal" class="editor-modal">
      <div class="editor-modal-header">
        <h3>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <polyline points="16 18 22 12 16 6"></polyline>
            <polyline points="8 6 2 12 8 18"></polyline>
          </svg>
          <span data-i18n="responseEditor">JSON Editor</span>
        </h3>
        <div class="editor-modal-actions">
          <button
            type="button"
            id="modal-search-btn"
            class="btn-icon"
            data-i18n-title="searchReplaceCtrlF"
            style="margin-right: 8px"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="11" cy="11" r="8"></circle>
              <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
          </button>
          <button
            type="button"
            id="modal-close"
            class="btn-modal-close"
            data-i18n-title="closeEscKey"
            title="Close (Esc)"
          >
            √ó
          </button>
        </div>
      </div>
      <div class="editor-modal-content" id="editor-modal-content">
        <textarea
          id="modal-textarea"
          placeholder='{"success": true, "data": {}}'
        ></textarea>
      </div>
      <div class="editor-modal-footer">
        <div class="json-status">
          <span
            id="modal-json-status-indicator"
            class="json-status-indicator"
          ></span>
          <span
            id="modal-json-status-text"
            class="hint"
            data-i18n="responseContentHint"
            >Enter JSON response content to return</span
          >
        </div>
        <div class="modal-footer-actions">
          <button
            id="modal-save-btn"
            class="btn-primary"
            style="display: none"
            data-i18n="confirm"
          >
            Confirm
          </button>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settings-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="3"></circle>
              <path
                d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"
              ></path>
            </svg>
            <span data-i18n="settingsTitle">Settings</span>
          </h3>
          <button
            type="button"
            id="settings-close"
            class="btn-modal-close"
            data-i18n-title="close"
          >
            √ó
          </button>
        </div>
        <div class="modal-body">
          <div class="setting-item">
            <div class="setting-info">
              <span class="setting-title" data-i18n="consoleLogs"
                >Console Logs</span
              >
              <span class="setting-desc" data-i18n="consoleLogsDesc"
                >Show request interception debug info in browser console</span
              >
            </div>
            <label class="switch">
              <input type="checkbox" id="setting-console-log" />
              <span class="slider round"></span>
            </label>
          </div>
          <div class="setting-item">
            <div class="setting-info">
              <span class="setting-title" data-i18n="language">Language</span>
              <span class="setting-desc" data-i18n="languageDesc"
                >Select interface language</span
              >
            </div>
            <select id="setting-language" class="setting-select">
              <option value="en">English</option>
              <option value="zh_CN">‰∏≠Êñá</option>
            </select>
          </div>
        </div>
      </div>
    </div>

    <!-- cURL Import Modal -->
    <div id="curl-modal" class="modal">
      <div class="modal-content curl-modal-content">
        <div class="modal-header">
          <h3>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <path d="M4 17l6-6-6-6"></path>
              <path d="M12 19h8"></path>
            </svg>
            <span data-i18n="importFromCurl">Import from cURL</span>
          </h3>
          <button
            type="button"
            id="curl-modal-close"
            class="btn-modal-close"
            data-i18n-title="close"
          >
            √ó
          </button>
        </div>
        <div class="modal-body">
          <div class="curl-input-group">
            <label for="curl-input" data-i18n="curlCommand">cURL Command</label>
            <textarea
              id="curl-input"
              rows="8"
              placeholder="curl 'https://api.example.com/data' -X POST -H 'Content-Type: application/json' -d '{&quot;key&quot;: &quot;value&quot;}'"
              data-i18n-placeholder="curlCommandPlaceholder"
            ></textarea>
            <span class="hint" data-i18n="curlHint"
              >Paste the cURL command from browser DevTools (right-click request
              ‚Üí Copy as cURL)</span
            >
          </div>
          <div id="curl-error" class="curl-error"></div>
        </div>
        <div class="modal-footer">
          <button
            type="button"
            id="curl-cancel-btn"
            class="btn-secondary"
            data-i18n="cancel"
          >
            Cancel
          </button>
          <button
            type="button"
            id="curl-parse-btn"
            class="btn-primary"
            data-i18n="parseAndFill"
          >
            Parse & Fill
          </button>
        </div>
      </div>
    </div>

    <!-- Alert Modal -->
    <div id="alert-modal" class="modal alert-modal">
      <div class="modal-content alert-modal-content">
        <div class="modal-header alert-modal-header">
          <h3>
            <span class="alert-icon">‚ö†Ô∏è</span>
            <span id="alert-title" data-i18n="alertTitle">Alert</span>
          </h3>
          <button
            type="button"
            id="alert-modal-close"
            class="btn-modal-close"
            data-i18n-title="close"
          >
            √ó
          </button>
        </div>
        <div class="modal-body alert-modal-body">
          <p id="alert-message" class="alert-message"></p>
        </div>
        <div class="modal-footer alert-modal-footer">
          <button
            type="button"
            id="alert-confirm-btn"
            class="btn-primary"
            data-i18n="confirm"
          >
            OK
          </button>
        </div>
      </div>
    </div>

    <script src="lib/renderjson.js"></script>
    <!-- CodeMirror Ê†∏ÂøÉÂíåÊèí‰ª∂ -->
    <script src="lib/codemirror/codemirror.js"></script>
    <script src="lib/codemirror/mode/javascript/javascript.js"></script>
    <script src="lib/codemirror/addon/fold/foldcode.js"></script>
    <script src="lib/codemirror/addon/fold/foldgutter.js"></script>
    <script src="lib/codemirror/addon/fold/brace-fold.js"></script>
    <script src="i18n.js"></script>
    <script src="editorSearch.js"></script>
    <script src="popup.js"></script>
  </body>
</html>
